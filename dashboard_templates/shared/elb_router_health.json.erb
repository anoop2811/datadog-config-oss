{
  "graphs": [
    {
      "definition": {
        "viz": "timeseries",
        "requests": [
          {
            "q": "avg:aws.ec2.network_in{*} by {name}",
            "type": "area"
          }
        ],
        "events": [
          {
            "q": "tags:deployment:<%= deployment %> started deploying."
          }
        ]
      },
      "title": "aws.ec2.network_in"
    },
    {
      "definition": {
        "viz": "timeseries",
        "requests": [
          {
            "q": "avg:aws.ec2.network_out{*} by {name}",
            "type": "area"
          }
        ],
        "events": [
          {
            "q": "tags:deployment:<%= deployment %> started deploying."
          }
        ]
      },
      "title": "aws.ec2.network_out"
    },
    {
      "definition": {
        "viz": "timeseries",
        "requests": [
          {
            "q": "sum:aws.elb.request_count{*} by {host}",
            "type": "area"
          }
        ],
        "events": [
          {
            "q": "tags:deployment:<%= deployment %> started deploying."
          }
        ]
      },
      "title": "aws.elb.request_count"
    },
    {
      "definition": {
        "viz": "timeseries",
        "requests": [
          {
            "q": "avg:aws.elb.httpcode_elb_5xx{host:cf-router} by {availability-zone}",
            "type": "area"
          }
        ],
        "events": [
          {
            "q": "tags:deployment:<%= deployment %> started deploying."
          }
        ]
      },
      "title": "aws.elb.httpcode_elb_5xx"
    },
    {
      "definition": {
        "viz": "timeseries",
        "requests": [
          {
            "q": "avg:aws.elb.httpcode_backend_5xx{host:cf-router} by {availability-zone}",
            "type": "area"
          }
        ],
        "events": [
          {
            "q": "tags:deployment:<%= deployment %> started deploying."
          }
        ]
      },
      "title": "aws.elb.httpcode_backend_5xx"
    },
    {
      "definition": {
        "viz": "timeseries",
        "requests": [
          {
            "q": "avg:aws.elb.latency{host:cf-router} by {availability-zone}",
            "type": "area"
          }
        ],
        "events": [
          {
            "q": "tags:deployment:<%= deployment %> started deploying."
          }
        ]
      },
      "title": "aws.elb.latency"
    },
    {
      "definition": {
        "viz": "timeseries",
        "requests": [
          {
            "q": "avg:aws.elb.surge_queue_length{host:cf-router} by {availability-zone}",
            "type": "area"
          }
        ],
        "events": [
          {
            "q": "tags:deployment:<%= deployment %> started deploying."
          }
        ]
      },
      "title": "aws.elb.surge_queue_length"
    },
    {
      "definition": {
        "requests": [
          {
            "q": "avg:aws.elb.healthy_host_count{host:cf-router}"
          }
        ],
        "events": [
          {
            "q": "tags:deployment:<%= deployment %> started deploying."
          },
          {
            "q": "tags:deployment:<%= deployment %> finished deploying."
          }
        ]
      },
      "title": "aws.elb.healthy_host_count"
    },
    {
      "definition": {
        "requests": [
          {
            "q": "avg:aws.elb.un_healthy_host_count{host:cf-router}"
          }
        ],
        "events": [
          {
            "q": "tags:deployment:<%= deployment %> started deploying."
          },
          {
            "q": "tags:deployment:<%= deployment %> finished deploying."
          }
        ]
      },
      "title": "aws.elb.un_healthy_host_count"
    },
    {
      "definition": {
        "requests": [
          {
            "q": "per_second(sum:jmx.org.cloudfoundry.opentsdb.nozzle.gorouter.total_requests{deployment:<%= metron_agent_deployment %>} by {job,index})",
            "stacked": false
          }
        ],
        "events": [
          {
            "q": "tags:deployment:<%= deployment %> started deploying."
          },
          {
            "q": "tags:deployment:<%= deployment %> finished deploying."
          }
        ]
      },
      "title": "Requests per second, by router"
    },
    {
      "definition": {
        "viz": "timeseries",
        "requests": [
          {
            "q": "avg:jmx.org.cloudfoundry.opentsdb.nozzle.gorouter.total_routes{deployment:<%= metron_agent_deployment %>} by {job,index}",
            "type": "line"
          }
        ],
        "events": [
          {
            "q": "tags:deployment:<%= deployment %> started deploying."
          }
        ]
      },
      "title": "Total routes by router"
    },
    {
      "definition": {
        "viz": "timeseries",
        "requests": [
          {
            "q": "per_second(avg:jmx.org.cloudfoundry.opentsdb.nozzle.gorouter.bad_gateways{deployment:<%= metron_agent_deployment %>} by {job,index})",
            "type": "area"
          }
        ],
        "events": [
          {
            "q": "tags:deployment:<%= deployment %> started deploying."
          }
        ]
      },
      "title": "router.bad_gateways per second"
    },
    {
      "definition": {
        "viz": "heatmap",
        "requests": [
          {
           "q": "avg:jmx.org.cloudfoundry.opentsdb.nozzle.gorouter.latency{deployment:<%= metron_agent_deployment %>} by {job,index}",
            "conditional_formats": []
          }
        ],
        "events": [
          {
            "q": "tags:deployment:<%= deployment %> started deploying."
          }
        ]
      },
      "title": "Router Latency"
    },
    {
      "definition": {
        "viz": "timeseries",
        "requests": [
          {
            "q": "per_second(avg:jmx.org.cloudfoundry.opentsdb.nozzle.gorouter.rejected_requests{deployment:<%= metron_agent_deployment %>} by {job,index})",
            "type": "area"
          }
        ],
        "events": [
          {
            "q": "tags:deployment:<%= deployment %> started deploying."
          }
        ]
      },
      "title": "router.rejected_requests per second"
    },
    {
      "definition": {
        "viz": "timeseries",
        "requests": [
          {
            "q": "per_second(avg:jmx.org.cloudfoundry.opentsdb.nozzle.gorouter.total_requests{deployment:<%= metron_agent_deployment %>} by {job,index})",
            "type": "area"
          }
        ],
        "events": [
          {
            "q": "tags:deployment:<%= deployment %> started deploying."
          }
        ]
      },
      "title": "router.requests per second"
    },
    {
      "definition": {
        "viz": "timeseries",
        "requests": [
          {
            "q": "per_second(avg:jmx.org.cloudfoundry.opentsdb.nozzle.gorouter.responses{deployment:<%= metron_agent_deployment %>} by {job,index})",
            "type": "area"
          }
        ],
        "events": [
          {
            "q": "tags:deployment:<%= deployment %> started deploying."
          }
        ]
      },
      "title": "router.responses per second"
    }
  ],
  "description": "Health statistics from the routers and their ELBs",
  "title": "<%= environment %> Router and ELB health metrics"
}
